<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerichtverf√ºgbarkeit pr√ºfen</title>
  <link rel="stylesheet" href="user.css">
</head>
<body>
  <!-- Modal f√ºr √ñffnungszeiten -->
  <div id="preLoginModal" class="modal">
    <div class="modal-content">
      <h2>√ñffnungszeiten</h2>
      <div id="workingHoursDisplay" class="working-hours"></div>
      <p class="payment-message">
        Dieses Programm erm√∂glicht es Ihnen, Bestellungen ganz einfach √ºber WhatsApp aufzugeben und erst bei Erhalt der Bestellung zu bezahlen.
      </p>
      <button id="continueBtn">Weiter</button>
    </div>
  </div>

  <!-- ŸÖŸàÿØÿßŸÑ ÿÆÿßÿµ ÿ®ÿπÿ±ÿ∂ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™ von Admin Panel (nicht schlie√übar au√üer per "Verstanden") -->
  <div id="changesModal" class="modal" style="display: none;">
    <div class="modal-content">
      <h2>Das Gericht wurde ge√§ndert</h2>
      <p><b>Hinweis:</b> Das Gericht entspricht nicht mehr genau der Beschreibung auf dem Flyer.</p>
      <div id="changesList" style="text-align: left; margin-bottom: 15px;"></div>
      <button id="changesConfirmBtn">Verstanden</button>
    </div>
  </div>

  <div class="container">
    <h1>Gerichtverf√ºgbarkeit pr√ºfen</h1>
    <input type="text" id="itemNumber" placeholder="Gerichtsnummer eingeben">
    <textarea id="customerNotes" placeholder="Zus√§tzliche Hinweise (z. B. bitte ohne Zwiebeln)"></textarea>
    <button onclick="checkItem()">Pr√ºfen</button>
    <p id="result"></p>
    <!-- ÿ≤ÿ± ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿµŸÜŸÅ ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©ÿå ŸÖÿÆŸÅŸä ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäŸãÿß -->
    <button id="addToCartBtn" onclick="addToCart()" style="display: none;">In den Warenkorb</button>
    
    <!-- ÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ≥ŸÑÿ© -->
    <!-- ÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ≥ŸÑÿ© -->
<div id="cartContainer" style="display: none;">
  <h2><span class="cart-icon">üõí</span></h2>
  <ul id="cartList"></ul>
</div>


  <!-- Bestelldetails -->
  <div id="orderDetails" style="display: none;">
    <h2>Bestelldetails (optional)</h2>
    <div class="delivery-container">
      <label for="deliveryOption">Bestelloption:</label>
      <select id="deliveryOption">
        <option value="pickup">Selbstabholung</option>
        <option value="delivery">Lieferung</option>
      </select>
    </div>
    <div id="pickupScheduleField" style="display: none;">
      <label for="pickupDate">Gew√ºnschtes Abholdatum:</label>
      <input type="date" id="pickupDate">
      <label for="pickupTime">Gew√ºnschte Abholzeit:</label>
      <input type="time" id="pickupTime">
    </div>
    <div id="deliveryScheduleField" style="display: none;">
      <label for="deliveryDate">Gew√ºnschtes Lieferdatum:</label>
      <input type="date" id="deliveryDate">
      <label for="deliveryTime">Gew√ºnschte Lieferzeit:</label>
      <input type="time" id="deliveryTime">
    </div>
    <div id="deliveryFields" style="display: none;">
      <p style="font-size: 14px; color: #555; margin-bottom: 10px;">
        Hinweis: Bitte f√ºllen Sie diese Felder nur aus, wenn Sie eine Lieferung w√ºnschen.
      </p>
      <input type="text" id="vorname" placeholder="Vorname">
      <input type="text" id="nachname" placeholder="Nachname">
      <input type="text" id="strasse" placeholder="Stra√üe">
      <input type="text" id="hausnummer" placeholder="Hausnummer">
      <input type="text" id="plz" placeholder="PLZ">
      <input type="text" id="stadt" placeholder="Stadt">
    </div>
    <button onclick="showSavePopup()">Daten speichern</button>
    <button id="whatsappBtn" onclick="sendToWhatsApp()">Bestellung per WhatsApp senden</button>
  </div>

  <!-- Popup f√ºr Best√§tigung -->
  <div id="popupMessage" class="popup">
    <p>‚úÖ Ihre Daten wurden gespeichert. Sie m√ºssen sie nicht erneut eingeben.</p>
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    // Firebase-Konfiguration
    const firebaseConfig = {
      apiKey: "AIzaSyBeAkTPw9nswsCy9NtWEgf6nG4al5Qx83c",
      authDomain: "restaurant-system-f50cf.firebaseapp.com",
      databaseURL: "https://restaurant-system-f50cf-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "restaurant-system-f50cf",
      storageBucket: "restaurant-system-f50cf.firebasestorage.app",
      messagingSenderId: "220436037433",
      appId: "1:220436037433:web:9bfc0f85a8806a15ee72e8"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
  </script>

  <!-- Einbindung von user.js -->
  <script src="user.js"></script>

  <script>
    // ==================================================
    // updateTimeConstraints zur L√∂sung des Zeitzonenproblems
    // ==================================================
    function updateTimeConstraints() {
      const now = new Date();

      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const todayStr = `${year}-${month}-${day}`;

      const pickupDateInput = document.getElementById('pickupDate');
      const pickupTimeInput = document.getElementById('pickupTime');
      if (pickupDateInput && pickupTimeInput) {
        if (pickupDateInput.value === todayStr) {
          let minPickupTime = new Date(now.getTime() + 1 * 60 * 60 * 1000);
          let hours = String(minPickupTime.getHours()).padStart(2, '0');
          let minutes = String(minPickupTime.getMinutes()).padStart(2, '0');
          pickupTimeInput.min = `${hours}:${minutes}`;
        } else {
          pickupTimeInput.min = "00:00";
        }
      }

      const deliveryDateInput = document.getElementById('deliveryDate');
      const deliveryTimeInput = document.getElementById('deliveryTime');
      if (deliveryDateInput && deliveryTimeInput) {
        if (deliveryDateInput.value === todayStr) {
          let minDeliveryTime = new Date(now.getTime() + 2 * 60 * 60 * 1000);
          let hours = String(minDeliveryTime.getHours()).padStart(2, '0');
          let minutes = String(minDeliveryTime.getMinutes()).padStart(2, '0');
          deliveryTimeInput.min = `${hours}:${minutes}`;
        } else {
          deliveryTimeInput.min = "00:00";
        }
      }
    }

    document.getElementById('deliveryOption').addEventListener('change', function () {
      const deliveryFields = document.getElementById('deliveryFields');
      const pickupScheduleField = document.getElementById('pickupScheduleField');
      const deliveryScheduleField = document.getElementById('deliveryScheduleField');
      if (this.value === 'delivery') {
        deliveryFields.style.display = 'block';
        deliveryScheduleField.style.display = 'block';
        pickupScheduleField.style.display = 'none';
      } else {
        deliveryFields.style.display = 'none';
        deliveryScheduleField.style.display = 'none';
        pickupScheduleField.style.display = 'block';
      }
      updateTimeConstraints();
    });

    document.getElementById('pickupDate').addEventListener('change', updateTimeConstraints);
    document.getElementById('deliveryDate').addEventListener('change', updateTimeConstraints);

    window.addEventListener('load', updateTimeConstraints);

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("preLoginModal").style.display = "flex";
      document.getElementById("continueBtn").addEventListener("click", function () {
        document.getElementById("preLoginModal").style.display = "none";
      });
    });
  </script>
</body>
</html>
